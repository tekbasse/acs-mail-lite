Development notes and change log



Documentation changes are too numerous to deliniate.
General strategy is to separate into topics of:
setup, inbound email configuration, outbound email configuration,
and inbound email for package developers

Portions of these sources have been added to new docs:

http://openacs.org/xowiki/incoming_email
http://openacs.org/forums/message-view?message_id=543694

Some suggestions have been incorporated into new code.



API changes

If from is blank, the 'to' is new.

From                            To
 acs_mail_lite::mail_dir         acs_mail_lite::incoming_mail_dir
 acs_mail_lite::address_domain   acs_mail_lite::incoming_domain
 acs_mail_lite::get_package_id   apm_package_id_from_key
 acs_mail_lite::get_parameter    parameter::get_from_package_key
                                 acs_mail_lite::scan_incoming 
 acs_mail_lite::parse_email      See these ns_imap equivalents:
                                 ns_imap header #s msgno
                                 ns_imap header #s msgno hdrname
                                 ns_imap headers #s msgno ?-array name?
                                 ns_imap text #s msgno ?-flags flags?
                                 ns_imap body #s msgno part ?-flags flags? ?-decode? ?-file name?
acs_mail_lite::load_mails        acs_mail_lite::load_via_imap

                                 ns_imap struct #s msgno ?-flags flags? ?-array name?
                                 ns_imap bodystruct #s msgno part ?-flags flags? ?-array name?
                                 fetches all the structured information
                                 (envelope, internal date, RFC 822 size, flags, and body structure) for
                                 the given msgno and returns it as a Tcl name value list
                                 ns_imap bodystruct fetches just one particular message body part.
                                 if array name is specified result will be placed into array variable

                                 acs_mail_lite::parameters
                                  returns parameter names and values as a name value list 
                                 acs_mail_lite::parameters -name value 
                                  sets value to parameter 'name'
                                  This api bypasses issues of value updates not detected
                                  by scheduled procs by using existing OpenACS parameter api


Other useful lib procs provided by ns_map:

  ns_imap parsedate datestring
        parses date/time string and returns seconds since epoch if date is
        correct or empty string if not

  ns_imap uid #s msgno
        returns UID for specified message number

  ns_imap striphtml text ?tags?
        strips dangerous HTML tags from the given HTML text, 
        by default it removes body/title/div/object/frame tags.
        If tags are specified it will use them instead of internal list.

  ns_imap encode type data
  ns_imap decode type data
        performs encodeing/decoding given text according given format.
        type may be one of the following: base64 qprint

New parameters added to new section: inbound_email

Parameters
 BounceScanQueue                 IncomingScanQueue
 BounceDomain                    IncomingDomian
 send_immediately                SendImmediatelyP
                                 IMAPHost
                                 IMAPPassword
                                 IMAPPort
                                 IMAPTimeout
                                 IMAPUser
                                 IncomingFilterProcName
                                 ExternalSource default is blank. Value is prefixed to value of table.name: default acs_mail_lite_email_uid_map.src_ext value. Suggest setting to mailbox.host before use, or leave blank. Changing value resets memory of prior processed emails. To avoid re-processing prior email, do not change once a service is in use. Restart server after changing value for it to take effect.

